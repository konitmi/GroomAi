<!DOCTYPE html>
<html>
  <head>
    <title>üíá‚Äç‚ôÇÔ∏è GroomAI</title>
    <script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        background: #f9f9f9;
        padding: 40px;
      }
      #imageContainer img {
        max-width: 90%;
        margin-top: 20px;
        border-radius: 12px;
      }
      #error {
        color: red;
        margin-top: 15px;
      }
      #result {
        font-size: 1.2rem;
        margin-top: 20px;
      }
      #suggestion {
        font-weight: bold;
        font-size: 1.1rem;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <h1>üíá‚Äç‚ôÇÔ∏è GroomAI</h1>
    <input type="file" id="imageUpload" accept="image/*" />
    <div id="result">Upload your selfie to find your best hairstyle match!</div>
    <div id="suggestion"></div>
    <div id="imageContainer"></div>
    <div id="error"></div>

    <script>
      function distance(p1, p2) {
        return Math.sqrt((p1.x - p2.x) ** 2 + (p1.y - p2.y) ** 2);
      }

      function classifyFaceShape(jaw, forehead, height) {
        const ratio = forehead / jaw;
        const heightRatio = height / jaw;
        if (ratio > 1.05 && heightRatio > 1.4) return "Long";
        if (ratio < 0.9) return "Heart";
        if (Math.abs(ratio - 1) < 0.1 && heightRatio > 1.5) return "Oval";
        if (Math.abs(jaw - forehead) < 20 && heightRatio < 1.5) return "Square";
        return "Round";
      }

      function getHairstyle(shape) {
        const styles = {
          Oval: "Try a Quiff, Pompadour, or Slicked Back style.",
          Round: "Go for a High Fade or Angular Fringe.",
          Square: "Buzz Cut or Textured Crop suits you.",
          Heart: "Side Part or Medium Fringe is best.",
          Long: "Layered Flow or Side Swept looks great.",
        };
        return styles[shape] || "Try another image for better results.";
      }

      async function detectFace() {
        try {
          const input = document.getElementById("imageUpload");
          const img = await faceapi.bufferToImage(input.files[0]);
          document.getElementById("imageContainer").innerHTML = "";
          document.getElementById("imageContainer").append(img);

          const detection = await faceapi
            .detectSingleFace(img)
            .withFaceLandmarks();
          if (!detection) {
            document.getElementById("result").innerText =
              "‚ùå Face not detected. Try another image.";
            return;
          }

          const points = detection.landmarks.positions;
          const jaw = distance(points[4], points[12]);
          const forehead = distance(points[19], points[24]);
          const height = distance(points[8], points[27]);

          const faceShape = classifyFaceShape(jaw, forehead, height);
          document.getElementById(
            "result"
          ).innerText = `‚úÖ Detected Face Shape: ${faceShape}`;
          document.getElementById("suggestion").innerText =
            getHairstyle(faceShape);
          document.getElementById("error").innerText = "";
        } catch (err) {
          document.getElementById("error").innerText =
            "‚ùå Error detecting face: " + err.message;
        }
      }

      document
        .getElementById("imageUpload")
        .addEventListener("change", async () => {
          try {
            await faceapi.nets.ssdMobilenetv1.loadFromUri(
              "https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js/models"
            );
            await faceapi.nets.faceLandmark68Net.loadFromUri(
              "https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js/models"
            );
            console.log("‚úÖ Models loaded");
            detectFace();
          } catch (e) {
            document.getElementById("error").innerText =
              "‚ùå Failed to load models: " + e.message;
          }
        });
    </script>
  </body>
</html>
